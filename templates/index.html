<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Feedback Summarizer</title>
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Customer Feedback Summarizer</h1>
        
        <form id="feedbackForm" method="POST" enctype="multipart/form-data" class="mb-5">
            <div class="mb-3">
                <label for="reviews" class="form-label">Enter Customer Reviews:</label>
                <textarea id="reviews" name="reviews" class="form-control" rows="5" placeholder="Enter one review per line..."></textarea>
            </div>

            <div class="mb-3">
                <label for="csvFile" class="form-label">Upload Reviews (TXT or CSV):</label>
                <input type="file" id="csvFile" name="csvFile" class="form-control" accept=".txt, .csv">
            </div>
            <button type="submit" class="btn btn-primary">Submit Reviews</button>
        </form>
        
        <div id="summarySection" style="display: none;">
            <h3>Summary:</h3>
            <p id="summaryText"></p>

            <h3>Sentiment Analysis:</h3>
            <ul id="sentimentList"></ul>

            <button id="downloadBtn" class="btn btn-success">Download Summary & Analysis</button>
        </div>
    </div>

    <script>
        document.getElementById("feedbackForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let formData = new FormData(this);
    
            fetch("/", {
                method: "POST",
                body: formData
            }).then(response => response.json())
              .then(data => {
                document.getElementById("summaryText").innerText = data.summary;
                let sentimentList = document.getElementById("sentimentList");
                sentimentList.innerHTML = "";
        
                data.sentiments.forEach(([review, sentiment, score]) => {
                    let li = document.createElement("li");
                    li.innerHTML = `<strong>${review}</strong> âž” <span class="${sentiment.toLowerCase()}">${sentiment}</span> (Score: ${score})`;
                    sentimentList.appendChild(li);
                });

                document.getElementById("summarySection").style.display = "block";
            }).catch(console.error);
        });


        document.getElementById("downloadBtn").addEventListener("click", function() {
            fetch("/download", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    summary: document.getElementById("summaryText").innerText,
                    sentiments: Array.from(document.querySelectorAll("#sentimentList li")).map(li => li.innerText)
                })
            }).then(response => response.text())
              .then(text => {
                let blob = new Blob([text], { type: "text/plain" });
                let a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = "feedback_summary.txt";
                document.body.appendChild(a);
                a.click();
                a.remove();
            }).catch(console.error);
        });

    </script>
</body>
</html>
